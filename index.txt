情報通信

Inter(相互接続された)Net(ネットワーク)
・全世界規模のパケット効果網
・自律分散型ネットワークシステム(LAN)をルータもより相互接続している。

基本プロとはTCP/IPv4(IPv6)

パケット通信方式
○データを分割し、通信パケットにして伝送する。
　・送信者側は、データ(情報)を通信パケット(Packet)に分割する。
　・受信者側は、通信パケットからデータを再構成する。

○通信パケットにはヘッダ(Header)を付与して伝送する。
○ヘッダは相手の識別番号(Identifier)が設定されている。
　・TCP/IPのIPでは、IPアドレス(IP Address)

ネットワークシステムの階層化
○上下関係を持つ複数のプロトコルのより構成
　・上位層は下位層を使って、より高度な通信を行う。
○層間インターンフェースの標準化
　・階層を抽象化する。
　　・階層毎に異なるプロトコルを用いることも可能である。
　・現実的には、完全な抽象化は困難である。
○OSI参照モデル【7層モデル】との対応
　・TCP/IPは5層で定義されている。
○プロトコルスタック
　・階層図ではプロトコルが積み重なって見える。
○階層名とレイヤ
　・下からレイヤnとも呼ばれている。
	・レイヤ3 ネットワーク層
	・レイヤ2 データリンク層
	・レイヤ1 物理層

プロトコルとインターフェース
○プロトコル(Protocol)
　・ノード間で通信を行うための取り決め
　・同一階層間のデータ(制御、情報)交換
○インターフェース(interface)
　・上下の階層間の取り決め
　・上下の階層間のデータ(制御、情報)交換	

通信の分類(コネクションの型)
○コネクション(指向)型プロトコル
　・通信する前に、論理的な通信路(仮想回線、Virtual Circuit)を設定する。
　・通信品質、透過性、順序が保証される。
　・例：電話、TCP
○コネクション型プロトコル
　・いきなり送信する。
　・通信品質は保証されない(最善努力型通信)
　・例：通信、電報、郵便、IP、UDP、イーサネット

応用層(Application Layer)
○応用プロセス(Application Process)間で送受信されるデータに関した通信機能を制御する。
　・OSI 参照モデルでは更に3層に分かれる。
○プロトコル例
　・HTTP,FTP,SMTP,POP3,IMAP4,telnet,DNS,NFS

トランスポート層、ネットワーク層
○トランスポート層
　・透過的に、終端ノード間での効率の良いデータ転送を行う。
　・誤り制御、順序制御、フロー制御
　・TCP(信頼性のあるコネクション型プロトコル)
　・UDP (信頼性のないコネクション型プロトコル)
○ネットワーク層
　・経路選択と中継選択を行う。
　・IP(信頼性のないコネクションレス型プロトコル)

データリンク層、物理層
○データリンク層(Datalink Layer,Layer 2)
　・隣接するノード間でのデータ転送制御
　　・同一LAN内のノード間の通信
　・物理層と一体になって規定されていることが多い。
　　・イーサネットの制御(ソフトウェア)部分。
　　・PPP(Point to Point Protocol)

○物理層(Physical Layer)
　・電気的、物理的な信号の制御
　・イーサネットのケーブルやトポロジィの規格
　・具体例
　　・イーサネットの物理(ハードウェア)部分。
　　・電話回線(アナログ、ISDN、ADSL)

ネットワーク層　IPv4(Internet Protocol)
○ネットワーク層のプロトコル
　・ルータ(ゲートウェイ)によりLAN間を接続する。
○主な機能は経路選択と中継制御
　・PCでも経路選択表が必要である。
○コネクションレス(Cnection Less)型
　・最前努力型(Best effort)で、破壊されることもある。
○アドレス(ホストを識別するユニークな番号)は32ビット
　・割り当て可能なアドレスは枯渇した。









IPv4アドレス
○ホストを識別する番号
　・32ビットユニークな番号
　・インターネット内に同じIPv4アドレスを設定したホストが、2台以上存在できない。
○IPv4アドレスの表記
　・32ビットを1オクテット
※単位に10進数で表記する。
　　・0xac19012b⇨172.25.1.45
○区切りは’ . ’

IPv4アドレスのビット構成
○ネットワーク部(上位ビット)
　・ネットワーク(LAN)に割り当てる。
○ホスト部(下位ビット)
　・ネットワーク(LAN)内の各ホスト(ノード)に割り当てる。
○ネットワークの規模(LAN内のホスト数)により、ネットワーク部とホスト部のビット配分を調整する。
　・アドレスのネットワーク部によりグループ(LAN)を区別する。
　・グループ化することでアドレスを集約し、経路情報を節約する。
○割り当て可能なホスト数は2(h)-2
 ・h:ホスト部のビット数
　　・ルータ(ゲートウェイ)もホストとして数える
・n:ネットワーク部のビット数はn=32-h
・2個のIPv4アドレスはホストには使用できない。
　・例は172.25.0.0/16、クラスB,h＝16

　・ネットワーク(LAN)のIPv4アドレス(ホスト部が全て0)
　　・例：172.25.0.0

　・同一LAN内へのブロードキャストIPv4アドレス(ホスト部が全て1)
　　・例：172.25.255.255

IPv4のクラスレス(Class Less)アドレス
○ネットワーク部のビット数を明示する。
○ビット指示方式
　・/<n>
   ・例:/24(255.255.255.0)と同じ
○サブネットマスク(Subnet Mask)指示方式
　・ネットワーク部として残すビットを1とする。
　・例:255.255.255.0,0xfffff00(/24と同じ)

特別なIPv4アドレス
○ネットワーク(LAN)アドレス
　・ホスト部の全ビットが0、例:172.25.0.0
○指定したネットワークへのブロードキャスト(BC)
　・ホスト部の全ビットが1、例:172.255.255.255
○ローカルネットワークへのブロードキャスト(BC)
　・全ビットが1、例:255.255.255.255

○ループバック(LB)・アドレス
　127.0.0.1

ドメイン名(Domain Name)
○インターネット上のサイト(ホスト)の識別名
　・ホストを識別する名前である。
　・正式名は、FQDN(Fully Qualified Domain Name)と呼ぶ。
　　・www.jo.tomakomai-ct.jp

ドメイン名の階層構造
○ドメイン名は、ルートドメイン(.)からの階層構造になっている。
　・普通は省略して記述する。
○トップ・レベル・ドメイン(TLD:Top Level Domain)
　・ccTLD(country code TLD)、日本はjp
　・gtTLD(generic TLD)ではcom,deu等
○セカンド・レベル・ドメイン(SLD:Second Level Domain)
　・日本では、co,ac,ne等
○サイトが管理するドメイン
　・tomakomai-ct等


DNSサーバ
○機能分散と負荷分散
　・DNSサーバは、アドレス情報ファイル「ゾーンファイル」を管理している。
　・複数のDNSサーバがゾーンファイルのコピーを持っている。
　・複数のDNSサーバを配置することで負荷分散を行う。
　・DNSサーバの種類
　　・プライマリDNSサーバは、元となるゾーンファイルを管理している。
　　・セカンダリDNSサーバは、プライマリDNSサーバからゾーンファイルをコピーする。

名前の正引きと逆引き
○正引き
　・ホスト名をIPアドレスに変換する。
　・WWWのURLや、telnetのログインで使用している。
○逆引き
　・IPアドレスをホスト名に変換する。

IPデータグラムの送信
○直接配送
　・同一LAN内の隣接するホストに、データリンク層・物理層によりIPデータグラムを伝達する。
○間接配送
　・異なるLANのホストに、複数のルータ(ゲートウェイ)を経由してIPデータグラムを伝達する。

直接配送の手順
○通信相手の物理アドレス(MACアドレス)を解決する。
　・データリンク・物理層がイーサネットであればARP(Address Resolution Protocol)を使用する。

○イーサネットフレームを作成し、送信する。
　・送信先MACアドレスには、APPにより解決したMACアドレスを使用する。



MAC(イーサネット、物理)アドレス
○MAC(Media Access Control) 
　・W by indowsでは「物理アドレス」、「イーサネットアドレス」とも言う。
　・48ビットで表現する。
○複数の機器に同一のMACアドレスを割り当てない。
　・全世界でユニークな番号である。
○表記方法
　・48ビットを1オクテット単位に16進数で表記する。
　・区切りは’-‘か’:’
　　・00-26-83-2C-40-91
　　・00:11:2f:8a:e8:c0



ARP(Address Resolution Protocol)
○IPデータグラムを伝達したいホストのMACアドレスを解決する。
　・人間が作る対応表では、管理が容易ではない。
　　・新しいホストの接続やホストの切り離しへの対応。
　・必要な時にネットワークを使って解決する。
　・解決したMACアドレスは、一定時間キャッシュする。

ARPの手順
○MACアドレスを解決したいホストは、APP要求メッセージを送信する。
　・MACアドレスはブロードキャスト(1対全て)で送信する。

○対象のホストは、ARP応答メッセージを送信する。
　・MACアドレスはユニキャスト(1対1)で送信する。




経路選択(Routing)
○経路選択(Routing)機能
　・ネットワーク層の最も重要な機能である。
　・ルータ(ゲートウェイ)でIPデータグラムを転送する(バケツリレー)機能である。
○経路選択表
　・送信先IPアドレスから、次に転送するルータ(ゲートウェイ)を選択する表。

経路選択(ルーティング)アルゴリズム
○送信先のIPアドレスから経路エントリを探索アルゴリズムに従って探索する。
　・送信先IPアドレスに、各経路エントリのネットマスクをANDして、ネットワーク宛先に一致する経路エントリを探索する。
　・複数の経路エントリに一致した時は、ネットワーク部が最も長い経路エントリを選択する。
○「ネットワーク宛先」0.0.0.0は必ず一致する。
　・ディフォルトゲートウェイと呼ばれている。
　　・例えば、172.25.129.45は0.0.0.0以外一致しない。
　・経路選択表には必須の経路エントリである。
　・ディフォルトゲートウェイには、インターネットに最も近いルータのIPアドレスを設定する。

ルータ
○データリンク層レベルのネットワークを相互に結合するネットワークの相互接続配置である。
○受信したIPデータグラムに格納されている「送信先アドレス」を手がかりに、バケツリレー方式で、IPデータグラムを正しい経路に送信する。

間接配送の手順
○同一LAN内から、通信相手が属しているLANに向かう経路に接続しているルータを選択する。
　・経路選択(ルーティング)表から探索する。
○ARPによりルータのMACアドレスを解決する。
○イーサネットフレームを作成し、送信する。
　・イーサネットの送信先MACアドレスは、ルータのMACアドレス。
　・IPデータグラムの送信先IPアドレスは、通信相手のIPアドレス。

IPv4ヘッダ(IPv4Header)
○寿命「TTL」(Time To Live,8ビット)
　・IPv4データグラムの寿命である．
　・配送経路以上で，永久にループすることがある．
　・ルータを経由する毎にデクリメントされる．
　・0になったら，IPv4データグラムは破壊される．

IPデータグラムの寿命(TTL)
※スケジュール帳参照

ICMP(Internet Control Message Protocol)
○制御・エラー通知プロトコル
○ICMPの用途
　・ホストの正常性を確認する．
　・配送中のエラーを通知する．
　・適切な経路情報を通知する．
　・輻そう(ネットワークの混雑)を通知する．

Pingコマンド
○pingコマンドにICMPが実装されている．
○pingコマンドのオプション
　・TTL値

ICMPの機能(ICMPエコー)
○指定したホストの正常性を確認する．
　・ICMPエコー要求メッセージ
　・ICMPエコー応答メッセージ
○配送エラーを通知する．
　・上位プロトコルが存在しない．
　・ポート番号が存在しない．
　・送信先ネットワークインタフェースに到達不能である．
○時間切れ
　・TTLが0になった．
○方向転換
　・一時的に，送信元の経路情報を更新する．

DHCP(Dynamic Host Configuration protocol)
○動的にIPアドレス等を設定する．
　・ホスト・ディフォルトゲートウェイ・DNSサーバのIPアドレス，サブネットマスク等
○割当方法
　・動的　移動ホストや一時的に接続するホスト用．
　・自動　IPアドレスを永久に使用するホスト用．
　・手動　ホストに固定的にIPアドレスを設定する．
○割当手順
　・クライアントとサーバ間でネゴシエーションする．
○割当情報の有効期間がある．



IPv6の実用化の歴史
○IPv4からIPv6への移行が，ユーザやISPに全く受け入れらずに来た．
　・IPv6がIPv4に比べて顕著に優れた機能を提供する訳ではない．
　　・IPv6へ移行することに対するインセンティブがない．
　・ソフトウェアの変更やハードウェアの更新が必要である．
　・移行のためにコストがかかる．

ネットワーク層 IPv6
○広大なアドレス空間(128ビット)
　・アドレス全体では16Ei × 16Ei個または
　4Gi × 4Gi × 4Gi × 4Gi個
　　・LAN当りには16Ei個
　・多数の機器に個別にアドレスを割り当てることができる
　　・IoT(Internet Of Things)
　　・各種センサーや照明機器等
　　・モバイル情報端末

○IPヘッダの簡略化
　・固定長40オクテット
　・拡張ヘッダの導入
　・ルータでの転送の高速化
　・(ハードウェア処理)が可能になる．

○通信品質管理とセキュリティ機能
　・ヘッダに関係するフィールドが既にある．
　・IPSecが既に規定されている．

○アドレス割当ての自動化
　・ネットワークに接続すると自動的にアドレスを設定する．
　　・SLAAC(StateLess Address Auto Configuration)
   ・RA(ルータ通知)，DHCPv6が既に規定されている．

○階層化されたアドレス割当て
　・IPv6の反省から，アドレス割当てが階層化されている．
　・経路情報の集約により経路選択の負荷が軽減されている．

IPv6のアドレス表記方法
　・16ビット毎，16進数，’:’で区切る・
　　fe80:0000:0000:0000:0201:02ff:fe8d:1a90
  ・16ビット毎に，上位の0を省略する．
　　fe80:0:0:0:201:2ff:fe8d:1a90
　・一箇所だけは，連続する:0:を::に省略する．
　　fe80::201:2ff:fe8d:1a90
　・プレフィックス(ネットワーク部)を/<n>で表現する場合もある．
　　2001:123:4567::1/64

リンクローカルアドレス
○Link Local(Unicast) Address
○プレフィックスはfe80::/64
○LAN内のみ有効である．
　・全てのLANでのプレフィックスが同じなので，各LANを区別できない．
　・ネットワークインタフェース(IID)の指定が必要である．
　・ネットワーク管理用を想定している．
○自己完結で．自動設定可能である．

IPv6 LLAのアドレス表記方法
○リンクローカルアドレス(LLA)では，アドレスだけでIFID(network Interface ID)を特定できないので，IFIDを指定する．
　・FreeBSDでは，IFID 名(%<name>)で指定する．
　　　fe80::201:2ff:fe8d:1a90%x10
　・Windowsでは，IFID番号(%<no>)で指定する．
　　　fe80::34d2:1733:53e6:7e6b%12

ユニークローカルアドレス(ULA)
○Unique Local (Unicast) Address
○プレフィックスは
	fd + <Global ID>:<SLA>:/64
○サイト(組織)内のみ有効である．
　・一般に，サイト(組織)内の通信に使用する．
　・各LANに固有の<SLA>を割り当てるので，各 LANを区別できる．
　　・IFIDの指定は不要である．
○ルータ通知で自動設定するか，手動で設定する．

グローバルユニキャストアドレス(GUA)
○Global Unicast Address
○プレフィックスは1::/3(2進数では001)
○GRP(Global Routing Prefix)
　・階層化され，経路情報を集約することで経路選択の負荷を軽減している．
○インターネット全体で有効である．
　・インターネットに接続する時に使用する．
　・各LANに固有の<SLA>を割り当てるので，各LANを区別できる．
　　・IFIDの指定は不要である．
○ルータ通知で自動設定するか，手動で設定する．

インタフェースID(IFID)の生成
○匿名アドレス方式
　・乱数により割り当てる．
　・24時間毎に更新する．
　・Windows Vista以降は，ディフォルトでこの方式である．

○EUI-64(Extended Unique 64 Bit)方式
　・非推奨になった．意味不明なビット列が推奨される．
　・MACアドレスから生成する．

IPv6アドレス(通信形態による分類)
○ユニキャスト(1対1の通信)
　・1台のホストに割当てられるアドレス
○マルチキャスト(1対nの通信)
　・グループに割当てられるアドレス
○エニーキャスト(1対nの通信)
　・マルチキャストと同じ，近くのホスト

マルチキャストアドレス
○リンクローカル・マルチキャストアドレス
　ff02::<グループ識別子>
　・全ノード・マルチキャストアドレス
　　ff02::1
　・全ルータ・マルチキャストアドレス
　　ff02::2

特殊なIPv6アドレス
○未定義
　・0::0または::
○ループバック
　0::1または ::1

ネットワークのアドレス
○ネットワーク(LAN)アドレス
　・IPv6では，基本的にプレフィックス(ネットワーク部)は64ビット固定である．
　　・LLA:fe80::/64，LANを区別できない．
　　・ULA:fd:<Global ID>:<SLA>::/64
　　・GUA:<GRP>:<SLA>::/64(上位3ビットが001)

経路選択(Routing)
○IPv6も，経路選択(Routing)機能と，使用する経路選択表はIPv4と同じである．
○タイトル
　・Destination:宛先
　・Gateway:ルータのアドレス，link#<n>は直接配送
　・Netif:IFID

経路選択(ルーティング)アルゴリズム
○「ネットワーク宛先」defaultは必ず一致する．
　・ディフォルトゲートウェイと呼ばれている．
　　・例(winston):fe80::f66d:4ff:fe45:e9c2%re0
　・経路選択表には必須の経路エントリである．
　・ディフォルトゲートウェイには，インターネットに最も近いルータのIPアドレスを設定する．

データリンク層のアドレスの解決
○IPv4は，ARPを使用する．
　・要求をブロードキャストする．
　・ARPキャッシュは，UNIXでは20分有効である．
○IPv6は，NDP(近隣探索プロトコル)を使用する．
　・ICMPv6(近隣要請)とNA(近隣通知)を使用する．

NDP(近隣探索プロトコル)
○Neighbor Discovery Protocol
○ICMPv6の一部である．
　・データリンク層・物理層に依存しない．
○メッセージの種類
　・NS(近隣探索要請)メッセージ
　　・IPv6アドレス重複割当当検出にも使用している．
　・NA(近隣探索通知)メッセージ

RS(Router SOlicitation)メッセージ
○ホストが送信する．
○ホストが起動した時，自動的にRSメッセージを送信する，
○ホストは，RAメッセージを受信したら，情報を記録する．
○ルータが送信する．
○送信するタイミング
　・RSメッセージを受信した時に送信する．
　・定期的(標準では600秒毎)に送信する．
○RAで通知できる情報
　・ULA ,GUA等を生成するのに必要なアドレスのプレフィックス情報(Global ID,GRP,SLA)と有効時間
　・SLAACの有効性
　・DNSサーバのアドレスリスト
　・ディフォルトルータのアドレス
　　・RAを送ったルータのアドレス

ステートレスアドレス自動設定
○SLAAC(StateLess Address Auto Configuration)
○各ノードは起動的に，各スコープのアドレスを自動生成する．

LLAの自動設定
○インタフェースIDを生成する．
　・EUI-64方式，または匿名アドレス方式等がある．
○リンクローカルアドレスを生成する．
○DAD(重複検出)を行う．
○各ノードは起動時に，RS(ルータ要請)を送信し，RA(ルータ通知)を受信することによりULA等のアドレスを自動設定する．

応用層プログラムの識別:ポート番号
○接続相手の応用プロセスを識別する番号
　・応用プロセス毎に1つしかない，ユニークな番号が必要．
　・TCP/IPでは，ポート番号が使われている．
　　・netstat -an 子コマンド等では以下のように表示される．
　　　・FreeBSDでは172.25.8.140.53
　　　・Windowsでは，172.25.8.140:53

Well Known Port
○サーバ用のポート番号
　・インターネットの多くのコンピュータで利用されているサーバ(サービス)用のポート番号
　・0から1023

トランスポート層「TCP」
○信頼性のあるコネクション型プロトコル
　・上位層に対して仮想的な通信路(VC:Virtual Circuit)を提供する．
○信頼性を提供するための機能
　・誤り制御
　・順序制御
　・フロー制御と輻そう制御
○その他の機能
　・全二重通信
　・バイトストリームサービス
○信頼性のないコネクションレス型プロトコル
　・オーバヘッドが小さい．
　・処理効率が高く，高速である．
○UDPを使う応用層
　・DNS(Domain Name System)
　・NFS(Network File System)
　・音声，動画，VoIP等のストリームデータ

イーサネット
○データリンク層・物理層プロトコル
　・LAN(Local Area Network)用ネットワークとして開発された．
　・トポロジィ(接続形態)は，バス型→スター型に移行した．
　・リピータ(帯域共有)Hub→スイッチングハブHubに移行した．
○コネクションレス型プロトコル
　・最善努力型(ベストエフォート)プロトコルである．
　・イーサネット・フレームが破棄されることもある．
　・帯域共有型では衝突もある．
○伝送速度
　・LANだけでなく，WAN(Wide Area Network)にも使用されている．

100Base-TX
○仕様
　・伝送速度は，100Mbps．
　・制御方式，トポロジ，ケーブル長は，10Base-Tと同じであるが，ケーブルはCAT5のUTPケーブルで2対使用している．
　・スイッチングHubが一般的なので，接続係数に制限はない．

1000Base-T
○仕様
　・伝送速度は，1Gbps．
　・制御方式は，基本的に，CSMA/CDを全く使わない全二重方式のみ．
　・トポロジィとケーブル長は，100Base-TXと同じであるが，ケーブルはCAT5eまたは，CAT6のUTPケーブルで4対使用している．最大100m．
　・1000Base-T/100Base-TX/10Base-Tに対応し，自動切替え方式のHubとNICが一般的に使われている．

イーサネットの通信形態
○全二重通信
　・UTPと光ファイバのみ実現可能である．
　・CSMA/CD制御方式を使用しない．
　・送信と受信を同時にできる．
　　・見かけ上，通信速度が2倍になる．
　・現在はこの方式が使われている．
○半二重通信
　・同軸ケーブル(バス型)では，この通信形態のみ可能である．
　・CSMA/CD制御方式を使用する．
　・1つのホストだけ送信できる．

スイッチング Hub(SW Hub)
○データリングで中継する．
　・フレームを認識し，送信先MACアドレスを持つホストが接続されているポートにのみフレームを転送する．
　　・1度フレームを全て受信し，蓄積してから転送する．
　・レイヤ2スイッチとも言われている．

○特徴
　・全二重と半二重のいずれにも対応可能である．
　・速度の異なるセグメントも相互接続可能である．

Wi-Fi(無線LAN)
○Wi-Fi Allianceで認定された機器には，Wi-Fiロゴの使用が許可される．
○正式な企画名はIEEE802.11であり，方式により，IEEE802.11aなどの名称がつけられている．
　・2019年から，Wi-Fi<n>と表記することになる．
　　・11n→Wi-Fi 4，11ac→Wi-Fi 5
○親機(AP,Access Point)と複数の子機関で無線による通信を行う．
　・無線LANに使われる無線方式は，小電力無線方式のため，無線局の免許は不要である．

周波数帯域(2.4[Ghz]帯)
○IEEE802.11/b/g/nで使用している．
○帯域幅 20[MHz]，14チャンネル
　・各チャンネルの周波数帯域が重なっており，干渉なしに通信できるのは実質的に3チャンネルである．
　・使用可能なチャンネル数が少なく，混信が多い．
　・屋内，屋外とも使用可能である．

周波数帯域(5[GHz]帯)
○IEEE802.11/a/n/acで使用している．
○帯域幅 20[MHz]，19チャンネル
　・チャンネルの周波数帯が重なっておらず，全チャンネル干渉がなく，使用できるチャンネル数が多い．
　・帯域のグループは，W52,W53,W56がある．
　・他の機器から干渉を受ける可能性が2.4[GHz]帯より低い．
　・壁などの障害物があると電波が届きにくくなる．



